2025/11/12 15:44:10 âœ… Connected to Supabase PostgreSQL (simple protocol enabled)!

2025/11/12 15:44:10 [32m/Users/aditisaxena/mental-health-be/config/database.go:37 [33mSLOW SQL >= 200ms
[0m[31;1m[573.935ms] [33m[rows:0][35m CREATE EXTENSION IF NOT EXISTS "uuid-ossp";[0m

2025/11/12 15:44:11 [32m/Users/aditisaxena/mental-health-be/config/database.go:40 [33mSLOW SQL >= 200ms
[0m[31;1m[285.907ms] [33m[rows:0][35m CREATE EXTENSION IF NOT EXISTS "pgcrypto";[0m
2025/11/12 15:44:11 âœ… Connected to PostgreSQL!

2025/11/12 15:44:11 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:8 [33mSLOW SQL >= 200ms
[0m[31;1m[286.399ms] [33m[rows:0][35m 
		DO $$ BEGIN 
			-- User roles
			IF NOT EXISTS (SELECT 1 FROM pg_type WHERE typname = 'user_role') THEN 
				CREATE TYPE user_role AS ENUM ('student', 'admin', 'chief_admin', 'counselor'); 
			END IF;

			-- Complaint types
			IF NOT EXISTS (SELECT 1 FROM pg_type WHERE typname = 'complaint_type') THEN 
				CREATE TYPE complaint_type AS ENUM (
					'roommate', 
					'plumbing', 
					'cleanliness', 
					'electricity', 
					'Lost and Found', 
					'Other Issues'
				); 
			END IF;

			-- Complaint statuses
			IF NOT EXISTS (SELECT 1 FROM pg_type WHERE typname = 'status_type') THEN 
				CREATE TYPE status_type AS ENUM (
					'open', 
					'inprogress', 
					'resolved'
				); 
			END IF;
			-- Apology types
			IF NOT EXISTS (SELECT 1 FROM pg_type WHERE typname = 'apology_type') THEN 
				CREATE TYPE apology_type AS ENUM (
					'outing',
					'misconduct',
					'miscellaneous'
				);
			END IF;

			-- Apology statuses
			IF NOT EXISTS (SELECT 1 FROM pg_type WHERE typname = 'apology_status') THEN 
				CREATE TYPE apology_status AS ENUM (
					'submitted', 
					'reviewed', 
					'accepted', 
					'rejected'
				);
			END IF;
		END $$;
	[0m

2025/11/12 15:44:11 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:57 [33mSLOW SQL >= 200ms
[0m[31;1m[342.918ms] [33m[rows:0][35m ALTER TYPE complaint_type ADD VALUE IF NOT EXISTS 'electricity';[0m

2025/11/12 15:44:11 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:58 [33mSLOW SQL >= 200ms
[0m[31;1m[277.387ms] [33m[rows:0][35m ALTER TYPE complaint_type ADD VALUE IF NOT EXISTS 'Lost and Found';[0m

2025/11/12 15:44:12 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:59 [33mSLOW SQL >= 200ms
[0m[31;1m[271.326ms] [33m[rows:0][35m ALTER TYPE complaint_type ADD VALUE IF NOT EXISTS 'Other Issues';[0m

2025/11/12 15:44:12 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:62 [33mSLOW SQL >= 200ms
[0m[31;1m[277.962ms] [33m[rows:0][35m ALTER TYPE user_role ADD VALUE IF NOT EXISTS 'chief_admin';[0m

2025/11/12 15:44:12 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:65 [33mSLOW SQL >= 200ms
[0m[31;1m[482.552ms] [33m[rows:1][35m SELECT count(*) FROM information_schema.tables WHERE table_schema = CURRENT_SCHEMA() AND table_name = 'users' AND table_type = 'BASE TABLE'[0m

2025/11/12 15:44:13 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:65 [33mSLOW SQL >= 200ms
[0m[31;1m[279.465ms] [33m[rows:1][35m SELECT CURRENT_DATABASE()[0m

2025/11/12 15:44:13 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:65 [33mSLOW SQL >= 200ms
[0m[31;1m[308.455ms] [33m[rows:-][35m SELECT c.column_name, c.is_nullable = 'YES', c.udt_name, c.character_maximum_length, c.numeric_precision, c.numeric_precision_radix, c.numeric_scale, c.datetime_precision, 8 * typlen, c.column_default, pd.description, c.identity_increment FROM information_schema.columns AS c JOIN pg_type AS pgt ON c.udt_name = pgt.typname LEFT JOIN pg_catalog.pg_description as pd ON pd.objsubid = c.ordinal_position AND pd.objoid = (SELECT oid FROM pg_catalog.pg_class WHERE relname = c.table_name AND relnamespace = (SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = c.table_schema)) where table_catalog = 'neondb' AND table_schema = CURRENT_SCHEMA() AND table_name = 'users'[0m

2025/11/12 15:44:14 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:65 [33mSLOW SQL >= 200ms
[0m[31;1m[632.168ms] [33m[rows:-][35m SELECT * FROM "users" LIMIT 5[0m

2025/11/12 15:44:14 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:65 [33mSLOW SQL >= 200ms
[0m[31;1m[307.541ms] [33m[rows:-][35m SELECT constraint_name FROM information_schema.table_constraints tc JOIN information_schema.constraint_column_usage AS ccu USING (constraint_schema, constraint_catalog, table_name, constraint_name) JOIN information_schema.columns AS c ON c.table_schema = tc.constraint_schema AND tc.table_name = c.table_name AND ccu.column_name = c.column_name WHERE constraint_type IN ('PRIMARY KEY', 'UNIQUE') AND c.table_catalog = 'neondb' AND c.table_schema = CURRENT_SCHEMA() AND c.table_name = 'users' AND constraint_type = 'UNIQUE'[0m

2025/11/12 15:44:14 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:65 [33mSLOW SQL >= 200ms
[0m[31;1m[310.482ms] [33m[rows:-][35m SELECT c.column_name, constraint_name, constraint_type FROM information_schema.table_constraints tc JOIN information_schema.constraint_column_usage AS ccu USING (constraint_schema, constraint_catalog, table_name, constraint_name) JOIN information_schema.columns AS c ON c.table_schema = tc.constraint_schema AND tc.table_name = c.table_name AND ccu.column_name = c.column_name WHERE constraint_type IN ('PRIMARY KEY', 'UNIQUE') AND c.table_catalog = 'neondb' AND c.table_schema = CURRENT_SCHEMA() AND c.table_name = 'users'[0m

2025/11/12 15:44:15 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:65 [33mSLOW SQL >= 200ms
[0m[31;1m[276.244ms] [33m[rows:-][35m SELECT a.attname as column_name, format_type(a.atttypid, a.atttypmod) AS data_type
		FROM pg_attribute a JOIN pg_class b ON a.attrelid = b.oid AND relnamespace = (SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = CURRENT_SCHEMA())
		WHERE a.attnum > 0 -- hide internal columns
		AND NOT a.attisdropped -- hide deleted columns
		AND b.relname = 'users'[0m

2025/11/12 15:44:15 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:65 [33mSLOW SQL >= 200ms
[0m[31;1m[281.894ms] [33m[rows:0][35m SELECT description FROM pg_catalog.pg_description WHERE objsubid = (SELECT ordinal_position FROM information_schema.columns WHERE table_schema = CURRENT_SCHEMA() AND table_name = 'users' AND column_name = 'id') AND objoid = (SELECT oid FROM pg_catalog.pg_class WHERE relname = 'users' AND relnamespace = (SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = CURRENT_SCHEMA()))[0m

2025/11/12 15:44:15 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:65 [33mSLOW SQL >= 200ms
[0m[31;1m[286.275ms] [33m[rows:0][35m SELECT description FROM pg_catalog.pg_description WHERE objsubid = (SELECT ordinal_position FROM information_schema.columns WHERE table_schema = CURRENT_SCHEMA() AND table_name = 'users' AND column_name = 'name') AND objoid = (SELECT oid FROM pg_catalog.pg_class WHERE relname = 'users' AND relnamespace = (SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = CURRENT_SCHEMA()))[0m

2025/11/12 15:44:15 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:65 [33mSLOW SQL >= 200ms
[0m[31;1m[281.021ms] [33m[rows:0][35m SELECT description FROM pg_catalog.pg_description WHERE objsubid = (SELECT ordinal_position FROM information_schema.columns WHERE table_schema = CURRENT_SCHEMA() AND table_name = 'users' AND column_name = 'email') AND objoid = (SELECT oid FROM pg_catalog.pg_class WHERE relname = 'users' AND relnamespace = (SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = CURRENT_SCHEMA()))[0m

2025/11/12 15:44:16 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:65 [33mSLOW SQL >= 200ms
[0m[31;1m[304.361ms] [33m[rows:0][35m SELECT description FROM pg_catalog.pg_description WHERE objsubid = (SELECT ordinal_position FROM information_schema.columns WHERE table_schema = CURRENT_SCHEMA() AND table_name = 'users' AND column_name = 'password') AND objoid = (SELECT oid FROM pg_catalog.pg_class WHERE relname = 'users' AND relnamespace = (SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = CURRENT_SCHEMA()))[0m

2025/11/12 15:44:16 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:65 [33mSLOW SQL >= 200ms
[0m[31;1m[282.759ms] [33m[rows:0][35m SELECT description FROM pg_catalog.pg_description WHERE objsubid = (SELECT ordinal_position FROM information_schema.columns WHERE table_schema = CURRENT_SCHEMA() AND table_name = 'users' AND column_name = 'role') AND objoid = (SELECT oid FROM pg_catalog.pg_class WHERE relname = 'users' AND relnamespace = (SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = CURRENT_SCHEMA()))[0m

2025/11/12 15:44:16 [32m [33mSLOW SQL >= 200ms
[0m[31;1m[436.209ms] [33m[rows:1][35m SELECT CURRENT_DATABASE()[0m

2025/11/12 15:44:17 [32m [33mSLOW SQL >= 200ms
[0m[31;1m[617.596ms] [33m[rows:-][35m SELECT c.column_name, c.is_nullable = 'YES', c.udt_name, c.character_maximum_length, c.numeric_precision, c.numeric_precision_radix, c.numeric_scale, c.datetime_precision, 8 * typlen, c.column_default, pd.description, c.identity_increment FROM information_schema.columns AS c JOIN pg_type AS pgt ON c.udt_name = pgt.typname LEFT JOIN pg_catalog.pg_description as pd ON pd.objsubid = c.ordinal_position AND pd.objoid = (SELECT oid FROM pg_catalog.pg_class WHERE relname = c.table_name AND relnamespace = (SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = c.table_schema)) where table_catalog = 'neondb' AND table_schema = CURRENT_SCHEMA() AND table_name = 'users'[0m

2025/11/12 15:44:17 [32m [33mSLOW SQL >= 200ms
[0m[31;1m[281.783ms] [33m[rows:-][35m SELECT * FROM "users" LIMIT 5[0m

2025/11/12 15:44:18 [32m [33mSLOW SQL >= 200ms
[0m[31;1m[328.837ms] [33m[rows:-][35m SELECT constraint_name FROM information_schema.table_constraints tc JOIN information_schema.constraint_column_usage AS ccu USING (constraint_schema, constraint_catalog, table_name, constraint_name) JOIN information_schema.columns AS c ON c.table_schema = tc.constraint_schema AND tc.table_name = c.table_name AND ccu.column_name = c.column_name WHERE constraint_type IN ('PRIMARY KEY', 'UNIQUE') AND c.table_catalog = 'neondb' AND c.table_schema = CURRENT_SCHEMA() AND c.table_name = 'users' AND constraint_type = 'UNIQUE'[0m

2025/11/12 15:44:18 [32m [33mSLOW SQL >= 200ms
[0m[31;1m[306.718ms] [33m[rows:-][35m SELECT c.column_name, constraint_name, constraint_type FROM information_schema.table_constraints tc JOIN information_schema.constraint_column_usage AS ccu USING (constraint_schema, constraint_catalog, table_name, constraint_name) JOIN information_schema.columns AS c ON c.table_schema = tc.constraint_schema AND tc.table_name = c.table_name AND ccu.column_name = c.column_name WHERE constraint_type IN ('PRIMARY KEY', 'UNIQUE') AND c.table_catalog = 'neondb' AND c.table_schema = CURRENT_SCHEMA() AND c.table_name = 'users'[0m

2025/11/12 15:44:18 [32m [33mSLOW SQL >= 200ms
[0m[31;1m[299.241ms] [33m[rows:-][35m SELECT a.attname as column_name, format_type(a.atttypid, a.atttypmod) AS data_type
		FROM pg_attribute a JOIN pg_class b ON a.attrelid = b.oid AND relnamespace = (SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = CURRENT_SCHEMA())
		WHERE a.attnum > 0 -- hide internal columns
		AND NOT a.attisdropped -- hide deleted columns
		AND b.relname = 'users'[0m

2025/11/12 15:44:19 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:65 [33mSLOW SQL >= 200ms
[0m[31;1m[278.130ms] [33m[rows:0][35m ALTER TABLE "users" ALTER COLUMN "block" TYPE char(1) USING "block"::char(1)[0m

2025/11/12 15:44:19 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:65 [33mSLOW SQL >= 200ms
[0m[31;1m[273.936ms] [33m[rows:0][35m SELECT description FROM pg_catalog.pg_description WHERE objsubid = (SELECT ordinal_position FROM information_schema.columns WHERE table_schema = CURRENT_SCHEMA() AND table_name = 'users' AND column_name = 'block') AND objoid = (SELECT oid FROM pg_catalog.pg_class WHERE relname = 'users' AND relnamespace = (SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = CURRENT_SCHEMA()))[0m

2025/11/12 15:44:19 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:65 [33mSLOW SQL >= 200ms
[0m[31;1m[273.402ms] [33m[rows:0][35m SELECT description FROM pg_catalog.pg_description WHERE objsubid = (SELECT ordinal_position FROM information_schema.columns WHERE table_schema = CURRENT_SCHEMA() AND table_name = 'users' AND column_name = 'created_at') AND objoid = (SELECT oid FROM pg_catalog.pg_class WHERE relname = 'users' AND relnamespace = (SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = CURRENT_SCHEMA()))[0m

2025/11/12 15:44:19 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:65 [33mSLOW SQL >= 200ms
[0m[31;1m[273.551ms] [33m[rows:1][35m SELECT count(*) FROM INFORMATION_SCHEMA.table_constraints WHERE table_schema = CURRENT_SCHEMA() AND table_name = 'users' AND constraint_name = 'chk_users_block'[0m

2025/11/12 15:44:20 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:65 [33mSLOW SQL >= 200ms
[0m[31;1m[278.352ms] [33m[rows:1][35m SELECT count(*) FROM information_schema.tables WHERE table_schema = CURRENT_SCHEMA() AND table_name = 'student_models' AND table_type = 'BASE TABLE'[0m

2025/11/12 15:44:20 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:65 [33mSLOW SQL >= 200ms
[0m[31;1m[280.195ms] [33m[rows:1][35m SELECT CURRENT_DATABASE()[0m

2025/11/12 15:44:20 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:65 [33mSLOW SQL >= 200ms
[0m[31;1m[283.868ms] [33m[rows:-][35m SELECT c.column_name, c.is_nullable = 'YES', c.udt_name, c.character_maximum_length, c.numeric_precision, c.numeric_precision_radix, c.numeric_scale, c.datetime_precision, 8 * typlen, c.column_default, pd.description, c.identity_increment FROM information_schema.columns AS c JOIN pg_type AS pgt ON c.udt_name = pgt.typname LEFT JOIN pg_catalog.pg_description as pd ON pd.objsubid = c.ordinal_position AND pd.objoid = (SELECT oid FROM pg_catalog.pg_class WHERE relname = c.table_name AND relnamespace = (SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = c.table_schema)) where table_catalog = 'neondb' AND table_schema = CURRENT_SCHEMA() AND table_name = 'student_models'[0m

2025/11/12 15:44:21 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:65 [33mSLOW SQL >= 200ms
[0m[31;1m[275.244ms] [33m[rows:-][35m SELECT * FROM "student_models" LIMIT 5[0m

2025/11/12 15:44:21 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:65 [33mSLOW SQL >= 200ms
[0m[31;1m[282.939ms] [33m[rows:-][35m SELECT constraint_name FROM information_schema.table_constraints tc JOIN information_schema.constraint_column_usage AS ccu USING (constraint_schema, constraint_catalog, table_name, constraint_name) JOIN information_schema.columns AS c ON c.table_schema = tc.constraint_schema AND tc.table_name = c.table_name AND ccu.column_name = c.column_name WHERE constraint_type IN ('PRIMARY KEY', 'UNIQUE') AND c.table_catalog = 'neondb' AND c.table_schema = CURRENT_SCHEMA() AND c.table_name = 'student_models' AND constraint_type = 'UNIQUE'[0m

2025/11/12 15:44:21 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:65 [33mSLOW SQL >= 200ms
[0m[31;1m[276.452ms] [33m[rows:-][35m SELECT c.column_name, constraint_name, constraint_type FROM information_schema.table_constraints tc JOIN information_schema.constraint_column_usage AS ccu USING (constraint_schema, constraint_catalog, table_name, constraint_name) JOIN information_schema.columns AS c ON c.table_schema = tc.constraint_schema AND tc.table_name = c.table_name AND ccu.column_name = c.column_name WHERE constraint_type IN ('PRIMARY KEY', 'UNIQUE') AND c.table_catalog = 'neondb' AND c.table_schema = CURRENT_SCHEMA() AND c.table_name = 'student_models'[0m

2025/11/12 15:44:21 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:65 [33mSLOW SQL >= 200ms
[0m[31;1m[282.492ms] [33m[rows:-][35m SELECT a.attname as column_name, format_type(a.atttypid, a.atttypmod) AS data_type
		FROM pg_attribute a JOIN pg_class b ON a.attrelid = b.oid AND relnamespace = (SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = CURRENT_SCHEMA())
		WHERE a.attnum > 0 -- hide internal columns
		AND NOT a.attisdropped -- hide deleted columns
		AND b.relname = 'student_models'[0m

2025/11/12 15:44:22 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:65 [33mSLOW SQL >= 200ms
[0m[31;1m[279.693ms] [33m[rows:0][35m SELECT description FROM pg_catalog.pg_description WHERE objsubid = (SELECT ordinal_position FROM information_schema.columns WHERE table_schema = CURRENT_SCHEMA() AND table_name = 'student_models' AND column_name = 'id') AND objoid = (SELECT oid FROM pg_catalog.pg_class WHERE relname = 'student_models' AND relnamespace = (SELECT oid FROM pg_catalog.pg_namespace WHERE nspname = CURRENT_SCHEMA()))[0m

2025/11/12 15:44:22 [31;1m [35;1mERROR: constraint "uni_student_models_user_id" of relation "student_models" does not exist (SQLSTATE 42704)
[0m[33m[290.802ms] [34;1m[rows:0][0m ALTER TABLE "student_models" DROP CONSTRAINT "uni_student_models_user_id"

2025/11/12 15:44:22 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:78 [33mSLOW SQL >= 200ms
[0m[31;1m[282.278ms] [33m[rows:0][35m DO $$ BEGIN
		IF NOT EXISTS (SELECT 1 FROM pg_tables WHERE schemaname = CURRENT_SCHEMA() AND tablename = 'apology_attachments') THEN
			CREATE TABLE apology_attachments (
				id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
				apology_id uuid NOT NULL REFERENCES apologies(id) ON DELETE CASCADE,
				file_name text,
				file_url text,
				public_id text,
				size text
			);
		END IF;
	END $$;[0m

2025/11/12 15:44:23 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:92 [33mSLOW SQL >= 200ms
[0m[31;1m[296.994ms] [33m[rows:0][35m 
		ALTER TABLE complaints 
		ALTER COLUMN type TYPE complaint_type USING type::complaint_type,
		ALTER COLUMN status TYPE status_type USING status::status_type;
	[0m

2025/11/12 15:44:23 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:99 [33mSLOW SQL >= 200ms
[0m[31;1m[279.839ms] [33m[rows:0][35m DO $$ BEGIN
		IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='complaints' AND column_name='student_identifier') THEN
			ALTER TABLE complaints ADD COLUMN student_identifier text;
		END IF;
		IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='apologies' AND column_name='student_identifier') THEN
			ALTER TABLE apologies ADD COLUMN student_identifier text;
		END IF;
		-- Add priority column for complaints (text with default 'medium')
		IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='complaints' AND column_name='priority') THEN
			ALTER TABLE complaints ADD COLUMN priority text DEFAULT 'medium';
		END IF;
		-- Add PublicID column for attachments
		IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='attachments' AND column_name='public_id') THEN
			ALTER TABLE attachments ADD COLUMN public_id text;
		END IF;
	END $$;[0m

2025/11/12 15:44:23 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:117 [33mSLOW SQL >= 200ms
[0m[31;1m[285.941ms] [33m[rows:0][35m DO $$ BEGIN
		IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='student_models' AND column_name='student_identifier') THEN
			ALTER TABLE student_models ADD COLUMN student_identifier text;
		END IF;
		-- Create unique index on student_identifier if not exists
		IF NOT EXISTS (SELECT 1 FROM pg_indexes WHERE tablename='student_models' AND indexname='idx_student_models_student_identifier_unique') THEN
			BEGIN
				-- Try to create unique index; if duplicate values exist this will fail and we'll leave the index absent
				EXECUTE 'CREATE UNIQUE INDEX CONCURRENTLY idx_student_models_student_identifier_unique ON student_models (student_identifier)';
			EXCEPTION WHEN others THEN
				-- ignore index creation errors (duplicates, locks)
				NULL;
			END;
		END IF;
		-- Ensure block column exists (char(1), A-Z)
		IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='student_models' AND column_name='block') THEN
			ALTER TABLE student_models ADD COLUMN block char(1) NOT NULL DEFAULT 'A' CHECK (block ~ '^[A-Z]$');
		END IF;
		-- Ensure room_no column exists
		IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='student_models' AND column_name='room_no') THEN
			ALTER TABLE student_models ADD COLUMN room_no text;
		END IF;
	END $$;[0m

2025/11/12 15:44:23 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:142 [33mSLOW SQL >= 200ms
[0m[31;1m[282.783ms] [33m[rows:0][35m DO $$ BEGIN
		IF NOT EXISTS (SELECT 1 FROM pg_tables WHERE schemaname = CURRENT_SCHEMA() AND tablename = 'password_reset_tokens') THEN
			CREATE TABLE password_reset_tokens (
				id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
				user_id uuid NOT NULL REFERENCES users(id) ON DELETE CASCADE,
				token text NOT NULL UNIQUE,
				expires_at timestamptz,
				created_at timestamptz DEFAULT now()
			);
		END IF;
	END $$;[0m

2025/11/12 15:44:24 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:155 [33mSLOW SQL >= 200ms
[0m[31;1m[289.365ms] [33m[rows:0][35m DO $$ BEGIN
		IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='users' AND column_name='block') THEN
			ALTER TABLE users ADD COLUMN block char(1) NOT NULL DEFAULT 'A' CHECK (block ~ '^[A-Z]$');
		END IF;
	END $$;[0m

2025/11/12 15:44:24 [32m/Users/aditisaxena/mental-health-be/models/migrate.go:162 [33mSLOW SQL >= 200ms
[0m[31;1m[290.555ms] [33m[rows:0][35m DO $$ BEGIN
		-- If notifications table doesn't exist, create with the new schema
		IF NOT EXISTS (SELECT 1 FROM pg_tables WHERE schemaname = CURRENT_SCHEMA() AND tablename = 'notifications') THEN
			CREATE TABLE notifications (
				id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
				user_id uuid NOT NULL REFERENCES users(id) ON DELETE CASCADE,
				title text NOT NULL,
				message text NOT NULL,
				type text DEFAULT 'info',
				related_id uuid,
				related_type text,
				is_read boolean DEFAULT false,
				created_at timestamptz DEFAULT now(),
				updated_at timestamptz DEFAULT now()
			);
		ELSE
			-- Table exists: ensure new columns exist and migrate legacy columns
			-- Add user_id if missing and copy from admin_id when present
			IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='notifications' AND column_name='user_id') THEN
				ALTER TABLE notifications ADD COLUMN user_id uuid;
				IF EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='notifications' AND column_name='admin_id') THEN
					UPDATE notifications SET user_id = admin_id WHERE user_id IS NULL;
				END IF;
			END IF;

			-- Add message column and copy from body if body exists
			IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='notifications' AND column_name='message') THEN
				ALTER TABLE notifications ADD COLUMN message text;
				IF EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='notifications' AND column_name='body') THEN
					UPDATE notifications SET message = body WHERE message IS NULL;
				END IF;
			END IF;

			-- Add type, related_id, related_type, updated_at if missing
			IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='notifications' AND column_name='type') THEN
				ALTER TABLE notifications ADD COLUMN type text DEFAULT 'info';
			END IF;
			IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='notifications' AND column_name='related_id') THEN
				ALTER TABLE notifications ADD COLUMN related_id uuid;
			END IF;
			IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='notifications' AND column_name='related_type') THEN
				ALTER TABLE notifications ADD COLUMN related_type text;
			END IF;
			IF NOT EXISTS (SELECT 1 FROM information_schema.columns WHERE table_name='notifications' AND column_name='updated_at') THEN
				ALTER TABLE notifications ADD COLUMN updated_at timestamptz DEFAULT now();
			END IF;
		END IF;
	END $$;[0m

2025/11/12 15:44:24 [32m/Users/aditisaxena/mental-health-be/models/seed.go:14 [33mSLOW SQL >= 200ms
[0m[31;1m[303.193ms] [33m[rows:1][35m SELECT count(*) FROM "users"[0m
2025/11/12 15:44:24 ğŸŒ± Seed skipped (users already exist)
2025/11/12 15:44:24 ğŸ“¦ Database migrations completed successfully!
2025/11/12 15:44:24 ğŸš€ Server running at http://localhost:8080
2025/11/12 15:44:24 failed to listen: listen tcp4 :8080: bind: address already in use
exit status 1
